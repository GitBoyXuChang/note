# 常见的编码

推荐几个常用的地址：

- ASCII：http://tool.oschina.net/commons?type=4
- GB2312简体中文编码表：http://tools.jb51.net/table/gb2312
- Unicode编码：http://tool.chinaz.com/Tools/Unicode.aspx

#### 常见的编码

##### ASCII

它是现今最早最通用的单字节编码系统,并等同于国际标准`ISO/IEC 646`，其中一个英文字母（不分大小写）占一个字节的空间。

引申：字节是指一小组相邻的二进制数码。通常是8位作为一个字节，如00001111，换算为十进制。

最小值：-128

最大值：127

标准ASCII 码也叫基础ASCII码，使用7 位二进制数（剩下的1位二进制为0）来表示所有的大写和小写字母，数字0 到9、标点符号， 以及在美式英语中使用的特殊控制字符。其中：

- 1、0～31及127(共33个)是控制字符或通信专用字符（其余为可显示字符），如控制符：LF（换行）、CR（回车）、FF（换页）、DEL（删除）、BS（退格)、BEL（响铃）等；通信专用字符：SOH（文头）、EOT（文尾）、ACK（确认）等；ASCII值为8、9、10 和13 分别转换为退格、制表、换行和回车字符。它们并没有特定的图形显示，但会依不同的应用程序，而对文本显示有不同的影响。
- 2、32～126(共95个)是字符(32是空格），其中48～57为0到9十个阿拉伯数字。
- 3、65～90为26个大写英文字母，97～122号为26个小写英文字母，其余为一些标点符号、运算符号等。

同时还要注意，在标准ASCII中，其最高位(b7)用作奇偶校验位。所谓奇偶校验，是指在代码传送过程中用来检验是否出现错误的一种方法，一般分奇校验和偶校验两种。奇校验规定：正确的代码一个字节中1的个数必须是奇数，若非奇数，则在最高位b7添1；偶校验规定：正确的代码一个字节中1的个数必须是偶数，若非偶数，则在最高位b7添1。

##### UTF-8

UTF-8 是目前互联网上使用最广泛的一种 Unicode 编码方式，它的最大特点就是可变长。它可以使用 1 - 4 个字节表示一个字符，根据字符的不同变换长度。编码规则如下：

- 1、对于单个字节的字符，第一位设为 0，后面的 7 位对应这个字符的 Unicode 码点。因此，对于英文中的 0 - 127 号字符，与 ASCII 码完全相同。这意味着 ASCII 码那个年代的文档用 UTF-8 编码打开完全没有问题。
- 2、对于需要使用 N 个字节来表示的字符（N > 1），第一个字节的前 N 位都设为 1，第 N + 1 位设为0，剩余的 N - 1 个字节的前两位都设位 10，剩下的二进制位则使用这个字符的 Unicode 码点来填充。

| 序号 |        Unicode        |                               UTF-8 |
| :--: | :-------------------: | ----------------------------------: |
|  1   | 0000 0000 - 0000 007F |                            0xxxxxxx |
|  2   | 0000 0080 - 0000 07FF |                   110xxxxx 10xxxxxx |
|  3   | 0000 0800 - 0000 FFFF |          1110xxxx 10xxxxxx 10xxxxxx |
|  4   | 0001 0000 - 0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx |

下面以汉字“汉”为利，具体说明如何进行 UTF-8 编码和解码，大家就很容易理解了。

“汉”的 `Unicode` 码点是 `0x6c49（110 1100 0100 1001）`，通过上面的对照表可以发现，`0x0000 6c49` 位于第三行的范围，那么得出其格式为 `1110xxxx 10xxxxxx 10xxxxxx`。接着，从“汉”的二进制数最后一位开始，从后向前依次填充对应格式中的 x，多出的 x 用 0 补上。这样，就得到了“汉”的 UTF-8 编码为 `11100110 10110001 10001001`，转换成十六进制就是 `0xE6 0xB7 0x89`。

##### UTF-16

在了解 `UTF-16` 编码方式之前，先了解一下另外一个概念——“平面”。

在上面的介绍中，提到了 `Unicode` 是一本很厚的字典，她将全世界所有的字符定义在一个集合里。这么多的字符不是一次性定义的，而是分区定义。每个区可以存放 65536 个（216216）字符，称为一个平面（plane）。目前，一共有 17 个（2525）平面，也就是说，整个 `Unicode` 字符集的大小现在是 221221。

最前面的 65536 个字符位，称为基本平面（简称 BMP ），它的码点范围是从 0 到 216−1216−1，写成 16 进制就是从 U+0000 到 U+FFFF。所有最常见的字符都放在这个平面，这是 Unicode 最先定义和公布的一个平面。剩下的字符都放在辅助平面（简称 SMP ），码点范围从 U+010000 到 U+10FFFF。

基本了解了平面的概念后，再说回到 `UTF-16`。`UTF-16` 编码介于 `UTF-32` 与 `UTF-8` 之间，同时结合了定长和变长两种编码方法的特点。它的编码规则很简单：基本平面的字符占用 2 个字节，辅助平面的字符占用 4 个字节。也就是说，`UTF-16` 的编码长度要么是 2 个字节（U+0000 到 U+FFFF），要么是 4 个字节（U+010000 到 U+10FFFF）。那么问题来了，当我们遇到两个字节时，到底是把这两个字节当作一个字符还是与后面的两个字节一起当作一个字符呢？

这里有一个很巧妙的地方，在基本平面内，从 U+D800 到 U+DFFF 是一个空段，即这些码点不对应任何字符。因此，这个空段可以用来映射辅助平面的字符。

辅助平面的字符位共有 220220 个，因此表示这些字符至少需要 20 个二进制位。`UTF-16` 将这 20 个二进制位分成两半，前 10 位映射在 U+D800 到 U+DBFF，称为高位（H），后 10 位映射在 U+DC00 到 U+DFFF，称为低位（L）。这意味着，一个辅助平面的字符，被拆成两个基本平面的字符表示。

因此，当我们遇到两个字节，发现它的码点在 U+D800 到 U+DBFF 之间，就可以断定，紧跟在后面的两个字节的码点，应该在 U+DC00 到 U+DFFF 之间，这四个字节必须放在一起解读。

##### Unicode之Emoji表情

> 1999年前后，日本一个名叫栗田穰崇的年轻人，和许多直男一样， 给女友发的短信经常会被误解。比如，“知道了”被解读成“生气了”、“不耐烦了”，随后引发冷战。于是少年栗田想：“如果能在文字里插入一些表情符号来表达感情，大家应该会需要吧！” 原始的Emoji就这么诞生了。

`Emoji`字符是`Unicode`字符集中一部分. 特定形象的`Emoji`表情符号对应到特定的`Unicode`字节。常见的Emoji表情符号在Unicode字符集中的范围和具体的字节映射关系, 可通过**Emoji Unicode Tables** (http://apps.timwhitlock.info/emoji/tables/unicode#block-6c-other-additional-symbols)查看到。

对于做`UGC`的网站来说，现在不仅仅是苹果手机，越来越多的软件都在用`emoji`表情，因为它能很形象的来表达我们的感情。对于这里我们能做的可以是把emoji表情转码后用文本的方式存在数据库中，还有一个方式就是升级数据库，改变它的编码。

推荐一个对这个错误描述的地址：https://blog.csdn.net/asahinokawa/article/details/85255732

#### 一个汉字占几个字符？

如果你说的“字符”就是指 `Java` 中的 `char`，那好，那它就是 16 位，2 字节。

如果你说的“字符”是指我们用眼睛看到的那些“抽象的字符”，那么，谈论它占几个字节是没有意义的。具体地讲，脱离具体的编码谈某个字符占几个字节是没有意义的。就好比有一个抽象的整数“42”，你说它占几个字节？这得具体看你是用 `byte`，`short`，`int`，还是 `long` 来存它。用 byte 存就占一字节，用 `short` 存就占两字节，`int` 通常是四字节，`long` 通常八字节。当然，如果你用 `byte`，受限于它有限的位数，有些数它是存不了的，比如 256 就无法放在一个 `byte` 里了。

字符是同样的道理，如果你想谈“占几个字节”，就要先把编码说清楚。同一个字符在不同的编码下可能占不同的字节。就以你举的“字”字为例，“字”在 GBK 编码下占 2 字节，在 `UTF-16` 编码下也占 2 字节，在 `UTF-8` 编码下占 3 字节，在 `UTF-32` 编码下占 4 字节。不同的字符在同一个编码下也可能占不同的字节。“字”在 `UTF-8` 编码下占3字节，而“A”在 `UTF-8` 编码下占 1 字节。（因为 `UTF-8` 是变长编码），而 `Java` 中的 `char` 本质上是 `UTF-16` 编码。而 `UTF-16` 实际上也是一个变长编码（2 字节或 4字节）。

如果一个抽象的字符在 `UTF-16` 编码下占 4 字节，显然它是不能放到 `char` 中的。换言之， `char` 中只能放 `UTF-16` 编码下只占 2 字节的那些字符。

#### 参考地址

- https://zhidao.baidu.com/question/113144610.html
- https://www.jianshu.com/p/be286767563c